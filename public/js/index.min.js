var iflicks=function(){"use strict";function a(a){var b=document.getElementById("videoFile"),c=new window.FormData;c.append(b.name,b.files[0]),$("#uploadContainer").find(".uploadContainer").each(function(a,b){console.log(b),c.append(b.name,b.value)}),$.ajax({url:"upload/aa",type:"PUT",data:c,processData:!1,contentType:!1}).done(function(a){console.log(a)}).fail(function(a,b,c){var d=b+", "+c;console.log(d)})}function b(a){var b,c,d,e;for($("#videoList").hide(),$("#videoContainer").show(),clearInterval(p),$("#videoContainer").html('<video id="video" poster="thumb/'+a+'" data-setup="{}"  class="video-js vjs-default-skin"><source src="video/'+a+'/big.mp4" type="video/mp4"></source><source src="video/'+a+'/big.webm" type="video/webm"></source><source src="video/'+a+'/big.ogv" type="video/ogg"></source></video><div id="videoDetail"></div><div></div>'),b={controls:!0,autoplay:!1,preload:"auto",width:640,height:364},c=videojs(document.getElementById("video"),b,function(){}),c.one("play",function(){$.ajax({url:"playVideo/"+a,type:"POST"})}),console.log(s),d=0;d<s.length;d++)if(s[d]._id===a){e=s[d];break}e?($("<div>").text(e.name).addClass("videoName").appendTo("#videoContainer"),$("<div>").text(e.description).addClass("videoDescription").appendTo("#videoContainer"),$("<div>").text("Played "+e.playCount+" times").addClass("videoRunCount").appendTo("#videoContainer")):$.getJSON("videodetail/"+a).done(function(a){e=a,$("<div>").text(e.name).addClass("videoName").appendTo("#videoContainer"),$("<div>").text(e.description).addClass("videoDescription").appendTo("#videoContainer"),$("<div>").text("Played "+e.playCount+" times").addClass("videoRunCount").appendTo("#videoContainer")}).fail(function(a){console.log(a)})}function c(a){var c,d,e,f,g,i,j,k;for(c=document.getElementById("videoList");c.firstChild;)c.removeChild(c.firstChild);d=document.createDocumentFragment(),a.forEach(function(a,l){e=document.createElement("div"),f=document.createElement("img"),g=document.createElement("span"),i=document.createTextNode(a.name),j=document.createElement("span"),k=document.createTextNode("X"),e.className="vidDiv",f.className="vidThumb",g.className="vidName",j.className="vidDelete",f.src="thumb/"+a._id,g.appendChild(i),e.appendChild(f),e.appendChild(g),j.appendChild(k),a.uploader===r.id&&e.appendChild(j),d.appendChild(e),e.onclick=function(){var c=window.history.state||{};c.method="listVideos",c.scrollTop=document.body.scrollTop,window.history.replaceState(c,"List video",""),window.history.pushState({method:"playVideo",vid:a._id},"Play video","/"+a._id),b(a._id)},j.onclick=function(b){h(a._id),c.removeChild(e),b.stopPropagation()},l%10===0&&(c.appendChild(d),d=document.createDocumentFragment())}),c.appendChild(d)}function d(){$("#videoList").show(),$("#videoListUnencoded").hide(),$("#videoContainer").hide(),$("#video").get(0)&&videojs($("#video").get(0)).dispose(),clearInterval(p),s.length>0?$("#videoList").length!==s.length&&c(s):$.getJSON("videolist").done(function(a){Array.isArray(a)?(s=a,c(s)):console.log("Non array type returned.")}).fail(function(a){console.log(a)})}function e(){void 0!==window.EventSource&&(q=new window.EventSource("newvideo"),q.addEventListener("newVideo",function(a){$.getJSON("videolist").done(function(a){Array.isArray(a)?(s=a,c(s)):console.log("Non array type returned.")}).fail(function(a){console.log(a)})}))}function f(a){var b,c,d,e,f,g,h,i;for(b=document.getElementById("videoListUnencoded");b.firstChild;)b.removeChild(b.firstChild);c=document.createDocumentFragment(),a.forEach(function(a,j){d=document.createElement("div"),e=document.createElement("img"),f=document.createElement("span"),g=document.createTextNode(a.name),h=document.createElement("span"),i=document.createTextNode(void 0===a.encodeProgress?"Encoding not started.":Math.round(a.encodeProgress)+" %"),d.className="vidDiv",e.className="vidThumb",f.className="vidName",h.className="vidName",e.src="thumb/"+a._id,c.appendChild(d),d.appendChild(e),f.appendChild(g),h.appendChild(i),d.appendChild(f),d.appendChild(h),j%10===0&&(b.appendChild(c),c=document.createDocumentFragment())}),b.appendChild(c)}function g(){function a(){$.getJSON("videolistunencoded").done(function(a){Array.isArray(a)?f(a):console.log("Non array type returned.")}).fail(function(a){console.log(a)})}$("#videoListUnencoded").show(),$("#videoList").hide(),$("#videoContainer").hide(),$("#video").get(0)&&videojs($("#video").get(0)).dispose(),a(),p=setInterval(a,5e3)}function h(a){$.ajax({url:"video/"+a,type:"DELETE"}).done(function(a){console.log(a)}).fail(function(a,b,c){var d=b+", "+c;console.log(d)})}function i(){$("#uploadContainer").toggle("medium")}function j(a,b){b=b||{},$.ajax({contentType:"application/json",url:"login",type:a,data:JSON.stringify(b)}).done(function(a){r=a,document.getElementById("loggedinContainer").style.display="inline-block",document.getElementById("loginContainer").style.display="none",document.getElementById("showUploadContainer").style.display="inline-block",document.getElementById("headerBarUserName").textContent="Hello "+r.forename,document.getElementById("message").textContent=""}).fail(function(a,b,c){document.getElementById("message").textContent=a.responseText})}function k(){j("POST",{username:document.getElementById("username").value,password:document.getElementById("password").value})}function l(){j("GET",{})}function m(){r=void 0,document.getElementById("loggedinContainer").style.display="none",document.getElementById("loginContainer").style.display="inline-block",document.getElementById("showUploadContainer").style.display="inline-block",document.getElementById("message").textContent="",document.getElementById("headerBarUserName").textContent="",$.ajax({contentType:"application/json",url:"login",type:"DELETE"}).done(function(a){}).fail(function(a,b,c){document.getElementById("message").textContent=a.responseText})}function n(a){a()}function o(){n(function(){document.getElementById("submitUploadNewVideo").onclick=a,document.getElementById("submitLogin").onclick=k,document.getElementById("submitLogout").onclick=m,document.getElementById("showUploadContainer").onclick=i,document.getElementById("showVideoList").onclick=function(){window.history.pushState({method:"listVideos",vid:vid._id},"List video","/"),d()},document.getElementById("showUnencodedVideoList").onclick=function(){window.history.pushState({method:"listUnencoded"},"List unencoded videos","/"),g()},window.addEventListener("popstate",function(a){console.log(a.state.method),"playVideo"===a.state.method?b(a.state.vid):"listVideos"===a.state.method&&(d(),void 0!==a.state.scrollTop&&a.state.scrollTop>0&&window.scroll(a.state.scrollTop,0))}),l(),d(),e()})}var p,q,r={},s=[];return void 0!==document.addEventListener?document.addEventListener("DOMContentLoaded",function(){o()}):o(),{playVideo:b}}();